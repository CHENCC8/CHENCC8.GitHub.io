{
    "version": "https://jsonfeed.org/version/1",
    "title": "Orange • All posts by \"数据分析\" category",
    "description": "",
    "home_page_url": "https://chencc8.github.io",
    "items": [
        {
            "id": "https://chencc8.github.io/2022/03/09/shu-ju-fen-xi-xi-la/",
            "url": "https://chencc8.github.io/2022/03/09/shu-ju-fen-xi-xi-la/",
            "title": "数据分析-希腊",
            "date_published": "2022-03-09T08:20:38.000Z",
            "content_html": "<h1 id=\"好想去希腊啊啊啊\"><a href=\"#好想去希腊啊啊啊\" class=\"headerlink\" title=\"好想去希腊啊啊啊\"></a>好想去希腊啊啊啊</h1><p>因为想去希腊旅游，所以顺便做了一份小小的攻略（算是吧  <span class=\"github-emoji\"><span>😳</span><img src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f633.png?v8\" aria-hidden=\"true\" onerror=\"this.parent.classList.add('github-emoji-fallback')\"></span></p>\n<h2 id=\"main\"><a href=\"#main\" class=\"headerlink\" title=\"main\"></a>main</h2><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> plan</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 主页网址及请求头</span></span><br><span class=\"line\">urls = [<span class=\"string\">'https://you.ctrip.com/countrysightlist/greece100036/p{}.html'</span>.<span class=\"built_in\">format</span>(i) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">3</span>)]</span><br><span class=\"line\">headers = {</span><br><span class=\"line\">    <span class=\"string\">'user-agent'</span>: <span class=\"string\">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span></span><br><span class=\"line\">}</span><br><span class=\"line\">pd.set_option(<span class=\"string\">'display.unicode.ambiguous_as_wide'</span>, <span class=\"literal\">True</span>)</span><br><span class=\"line\">pd.set_option(<span class=\"string\">'display.unicode.east_asian_width'</span>, <span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获取源代码</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gethtmltext</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    <span class=\"keyword\">try</span>:</span><br><span class=\"line\">        res = requests.get(url, headers=headers, timeout=<span class=\"number\">30</span>)</span><br><span class=\"line\">        res.raise_for_status()</span><br><span class=\"line\">        res.encoding = res.apparent_encoding</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.text</span><br><span class=\"line\">    <span class=\"keyword\">except</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">''</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 主页解析</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">parsepage</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    links1 = []</span><br><span class=\"line\">    text = gethtmltext(url)</span><br><span class=\"line\">    soup = BeautifulSoup(text, <span class=\"string\">'html.parser'</span>)</span><br><span class=\"line\">    items = soup.select(<span class=\"string\">'div.list_mod1&gt;dl&gt;dd'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> items:</span><br><span class=\"line\">        tag = i.find(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">        name = tag.text</span><br><span class=\"line\">        link = tag[<span class=\"string\">'href'</span>]</span><br><span class=\"line\">        links1.append([name, link])</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> links1</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 获得景点速览链接</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getlinks3</span>():</span><br><span class=\"line\">    links3 = []</span><br><span class=\"line\">    links4 = []</span><br><span class=\"line\">    links5 = []</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> url <span class=\"keyword\">in</span> urls:</span><br><span class=\"line\">        links = parsepage(url)</span><br><span class=\"line\">        links3.append(links)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> links3:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> j:</span><br><span class=\"line\">            links4.append(i)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> k <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"built_in\">len</span>(links4), <span class=\"number\">2</span>):</span><br><span class=\"line\">        links5.append(<span class=\"string\">'https://you.ctrip.com/'</span> + links4[k][<span class=\"number\">1</span>])</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> links5</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获得链接中的数字</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getdigit</span>(<span class=\"params\">url</span>):</span><br><span class=\"line\">    url = <span class=\"built_in\">list</span>(<span class=\"built_in\">filter</span>(<span class=\"built_in\">str</span>.isdigit, url))</span><br><span class=\"line\">    digit = <span class=\"built_in\">int</span>(<span class=\"string\">''</span>.join(url))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> digit</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 景点速览页面解析</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">parsepages</span>(<span class=\"params\">links</span>):</span><br><span class=\"line\">    names1 = []</span><br><span class=\"line\">    wenttimes = []</span><br><span class=\"line\">    wanttimes = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> link <span class=\"keyword\">in</span> links:</span><br><span class=\"line\">        r = requests.get(link, headers=headers, timeout=<span class=\"number\">30</span>)</span><br><span class=\"line\">        text = r.text</span><br><span class=\"line\">        soup = BeautifulSoup(text, <span class=\"string\">'html.parser'</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 获取城市名称</span></span><br><span class=\"line\">        item = soup.select(<span class=\"string\">'div.f_left h1'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> item:</span><br><span class=\"line\">            tag = i.find(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">            name = tag.text</span><br><span class=\"line\">            names1.append(name)</span><br><span class=\"line\">        <span class=\"comment\"># 爬取动态网页数据（XHR）</span></span><br><span class=\"line\">        resource = getdigit(link)</span><br><span class=\"line\">        data = {</span><br><span class=\"line\">            <span class=\"string\">'Resource'</span>: <span class=\"string\">'{}'</span>.<span class=\"built_in\">format</span>(resource),</span><br><span class=\"line\">            <span class=\"string\">'pageType'</span>: <span class=\"string\">'Place'</span>,</span><br><span class=\"line\">        }</span><br><span class=\"line\">        r = requests.post(<span class=\"string\">\"https://you.ctrip.com/Destinationsite/SharedComm/ShowGowant\"</span>, data=data, headers=headers)</span><br><span class=\"line\">        wenttime = r.json()[<span class=\"string\">'WentTimes'</span>]</span><br><span class=\"line\">        wanttime = r.json()[<span class=\"string\">'WantTimes'</span>]</span><br><span class=\"line\">        wenttimes.append(wenttime)</span><br><span class=\"line\">        wanttimes.append(wanttime)</span><br><span class=\"line\">    datas = np.array([names1, wenttimes, wanttimes]).T</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">'希腊各城市旅游人数.csv'</span>, <span class=\"string\">'w'</span>, newline=<span class=\"string\">''</span>, encoding=<span class=\"string\">'utf-8'</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">        csv_writer = csv.writer(file)</span><br><span class=\"line\">        csv_writer.writerows(datas)</span><br><span class=\"line\">       </span><br><span class=\"line\"><span class=\"comment\"># 画出柱状图以及饼图</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">drawpicture</span>():</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">'希腊各城市旅游人数.csv'</span>, <span class=\"string\">'rt'</span>, newline=<span class=\"string\">''</span>, encoding=<span class=\"string\">'utf-8'</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">        csv_reader = csv.reader(file)</span><br><span class=\"line\">        names1 = [row[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> csv_reader]</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">'希腊各城市旅游人数.csv'</span>, <span class=\"string\">'rt'</span>, newline=<span class=\"string\">''</span>, encoding=<span class=\"string\">'utf-8'</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">        csv_reader = csv.reader(file)</span><br><span class=\"line\">        wenttimes = [row[<span class=\"number\">1</span>] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> csv_reader]</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">'希腊各城市旅游人数.csv'</span>, <span class=\"string\">'rt'</span>, newline=<span class=\"string\">''</span>, encoding=<span class=\"string\">'utf-8'</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">        csv_reader = csv.reader(file)</span><br><span class=\"line\">        wanttimes = [row[<span class=\"number\">2</span>] <span class=\"keyword\">for</span> row <span class=\"keyword\">in</span> csv_reader]</span><br><span class=\"line\">    wenttimes = [<span class=\"built_in\">float</span>(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> wenttimes]</span><br><span class=\"line\">    wanttimes = [<span class=\"built_in\">float</span>(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> wanttimes]</span><br><span class=\"line\">    plt.rcParams[<span class=\"string\">'font.family'</span>] = [<span class=\"string\">'SimHei'</span>]</span><br><span class=\"line\">    plt.subplot(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    plt.xticks(rotation=<span class=\"number\">300</span>)</span><br><span class=\"line\">    plt.title(<span class=\"string\">'各个城市旅游人数'</span>)</span><br><span class=\"line\">    plt.xlabel(<span class=\"string\">'城市'</span>)</span><br><span class=\"line\">    x = names1</span><br><span class=\"line\">    y1 = wenttimes</span><br><span class=\"line\">    y2 = wanttimes</span><br><span class=\"line\">    plt.plot(x, y1, label=<span class=\"string\">'去过'</span>)</span><br><span class=\"line\">    plt.plot(x, y2, label=<span class=\"string\">'想去'</span>)</span><br><span class=\"line\">    plt.legend()</span><br><span class=\"line\">    plt.subplot(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">    labels = names1[:<span class=\"number\">4</span>]</span><br><span class=\"line\">    nums = wenttimes[:<span class=\"number\">4</span>]</span><br><span class=\"line\">    plt.pie(nums, labels=labels, autopct=<span class=\"string\">'%0.1f%%'</span>)</span><br><span class=\"line\">    plt.show()</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># 排序存csv</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sortvalue</span>(<span class=\"params\">links</span>):</span><br><span class=\"line\">    df = pd.read_csv(<span class=\"string\">'希腊各城市旅游人数.csv'</span>, delimiter=<span class=\"string\">','</span>, header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">    df[<span class=\"number\">3</span>] = links</span><br><span class=\"line\">    df.sort_values(by=<span class=\"number\">1</span>, inplace=<span class=\"literal\">True</span>, axis=<span class=\"number\">0</span>, ascending=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    cities = df.loc[:<span class=\"number\">2</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    cities.to_csv(<span class=\"string\">'希腊热门城市.csv'</span>, index=<span class=\"literal\">False</span>, header=<span class=\"literal\">False</span>, encoding=<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    links = getlinks3()</span><br><span class=\"line\">    parsepages(links)</span><br><span class=\"line\">    drawpicture()</span><br><span class=\"line\">    sortvalue(links)</span><br><span class=\"line\">    lastlinks = plan.getplacelink()</span><br><span class=\"line\">    plan.getinformation(lastlinks)</span><br><span class=\"line\">    plan.cloudpicture()</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"plan包\"><a href=\"#plan包\" class=\"headerlink\" title=\"plan包\"></a>plan包</h2><figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> csv</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup</span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> wordcloud</span><br><span class=\"line\"><span class=\"keyword\">import</span> jieba</span><br><span class=\"line\">jieba.setLogLevel(jieba.logging.INFO)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">headers = {</span><br><span class=\"line\">    <span class=\"string\">'user-agent'</span>: <span class=\"string\">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\">poiID = [<span class=\"string\">'78674'</span>, <span class=\"string\">'89074'</span>, <span class=\"string\">'10532420'</span>, <span class=\"string\">'89071'</span>, <span class=\"string\">'98597'</span>, <span class=\"string\">'95446'</span>, <span class=\"string\">'95468'</span>, <span class=\"string\">'13271242'</span>, <span class=\"string\">'95469'</span>, <span class=\"string\">'10547255'</span>, <span class=\"string\">'96613'</span>, <span class=\"string\">'98965'</span>, <span class=\"string\">'96623'</span>, <span class=\"string\">'81903'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获得各城市景点链接</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getplacelink</span>():</span><br><span class=\"line\">    df = pd.read_csv(<span class=\"string\">'希腊热门城市.csv'</span>, delimiter=<span class=\"string\">','</span>, header=<span class=\"literal\">None</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    link = df[<span class=\"number\">3</span>]</span><br><span class=\"line\">    lastlinks = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> link:</span><br><span class=\"line\">        x = <span class=\"number\">0</span></span><br><span class=\"line\">        r = requests.get(i, headers=headers, timeout=<span class=\"number\">30</span>)</span><br><span class=\"line\">        soup = BeautifulSoup(r.text, <span class=\"string\">'html.parser'</span>)</span><br><span class=\"line\">        ii = soup.select(<span class=\"string\">'div.rdetailbox&gt;dl&gt;dt'</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ii:</span><br><span class=\"line\">            tag = i.find(<span class=\"string\">'a'</span>)</span><br><span class=\"line\">            lastlink = tag[<span class=\"string\">'href'</span>]</span><br><span class=\"line\">            lastlinks.append(lastlink)</span><br><span class=\"line\">            x = x + <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> x &gt; <span class=\"number\">4</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">    lastlinks.pop(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> lastlinks</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 获得景点列表</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getinformation</span>(<span class=\"params\">lastlinks</span>):</span><br><span class=\"line\">    names = []</span><br><span class=\"line\">    scores = []</span><br><span class=\"line\">    opentimes = []</span><br><span class=\"line\">    comments = []</span><br><span class=\"line\">    count = <span class=\"number\">0</span></span><br><span class=\"line\">    ID = []</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ids <span class=\"keyword\">in</span> poiID:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> page <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, <span class=\"number\">3</span>):</span><br><span class=\"line\">            payload = {<span class=\"string\">\"arg\"</span>:{<span class=\"string\">\"channelType\"</span>:<span class=\"number\">2</span>,</span><br><span class=\"line\">                              <span class=\"string\">\"collapseType\"</span>:<span class=\"number\">0</span>,</span><br><span class=\"line\">                              <span class=\"string\">\"commentTagId\"</span>:<span class=\"number\">0</span>,</span><br><span class=\"line\">                              <span class=\"string\">\"pageIndex\"</span>:page,</span><br><span class=\"line\">                              <span class=\"string\">\"pageSize\"</span>:<span class=\"number\">10</span>,</span><br><span class=\"line\">                              <span class=\"string\">\"poiId\"</span>: ids,</span><br><span class=\"line\">                              <span class=\"string\">\"sourceType\"</span>:<span class=\"number\">1</span>,</span><br><span class=\"line\">                              <span class=\"string\">\"sortType\"</span>:<span class=\"number\">3</span>,</span><br><span class=\"line\">                              <span class=\"string\">\"starType\"</span>:<span class=\"number\">0</span>},</span><br><span class=\"line\">                       <span class=\"string\">\"head\"</span>:{<span class=\"string\">\"cid\"</span>:<span class=\"string\">\"09031145113668832314\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"ctok\"</span>:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"cver\"</span>:<span class=\"string\">\"1.0\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"lang\"</span>:<span class=\"string\">\"01\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"sid\"</span>:<span class=\"string\">\"8888\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"syscode\"</span>:<span class=\"string\">\"09\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"auth\"</span>:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"xsid\"</span>:<span class=\"string\">\"\"</span>,</span><br><span class=\"line\">                               <span class=\"string\">\"extension\"</span>:[]}}</span><br><span class=\"line\">            ID.append(payload)</span><br><span class=\"line\"></span><br><span class=\"line\">    x = <span class=\"number\">0</span></span><br><span class=\"line\">    y = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> lastlink <span class=\"keyword\">in</span> lastlinks:</span><br><span class=\"line\">        r = requests.get(lastlink, headers=headers, timeout=<span class=\"number\">30</span>)</span><br><span class=\"line\">        soup = BeautifulSoup(r.text, <span class=\"string\">'html.parser'</span>)</span><br><span class=\"line\">        ii = soup.select(<span class=\"string\">'div.title'</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 获取各城市景点名称</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ii:</span><br><span class=\"line\">            tag = i.find(<span class=\"string\">'h1'</span>)</span><br><span class=\"line\">            name = tag.text</span><br><span class=\"line\">            names.append(name)</span><br><span class=\"line\">        <span class=\"comment\"># 获取各景点评论</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> x1 <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">2</span>):</span><br><span class=\"line\">            r = requests.post(<span class=\"string\">'https://m.ctrip.com/restapi/soa2/13444/json/getCommentCollapseList'</span>, data=json.dumps(ID[x]), headers=headers).text</span><br><span class=\"line\">            html = json.loads(r)</span><br><span class=\"line\">            items = html[<span class=\"string\">'result'</span>][<span class=\"string\">'items'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> items:</span><br><span class=\"line\">                comment = i[<span class=\"string\">'content'</span>]</span><br><span class=\"line\">                comments.append(comment)</span><br><span class=\"line\">            x = x + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"built_in\">str</span>(y) + <span class=\"string\">'.csv'</span>, <span class=\"string\">'w'</span>, newline=<span class=\"string\">''</span>, encoding=<span class=\"string\">'utf-8'</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">            csv_writer = csv.writer(file)</span><br><span class=\"line\">            csv_writer.writerows(comments)</span><br><span class=\"line\">        comments.clear()</span><br><span class=\"line\">        y = y + <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 词云</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">cloudpicture</span>():</span><br><span class=\"line\">    image_save = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> a <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">14</span>):</span><br><span class=\"line\">        image_save.append(<span class=\"string\">f'D://xila//<span class=\"subst\">{a + <span class=\"number\">1</span>}</span>.png'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">14</span>):</span><br><span class=\"line\">        f = <span class=\"built_in\">open</span>(<span class=\"built_in\">str</span>(i) + <span class=\"string\">'.csv'</span>, encoding=<span class=\"string\">'utf-8'</span>)</span><br><span class=\"line\">        text0 = f.read()</span><br><span class=\"line\">        text = text0.replace(<span class=\"string\">'，'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'。'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'：'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'！'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'？'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'“'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'【'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'】'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'；'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'&amp;'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">','</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'.'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'#'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">';'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'、'</span>, <span class=\"string\">''</span>).replace(<span class=\"string\">'\"'</span>, <span class=\"string\">''</span>)</span><br><span class=\"line\">        txt_list = jieba.lcut(text)</span><br><span class=\"line\">        texts = <span class=\"string\">' '</span>.join(txt_list)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(texts)</span><br><span class=\"line\">        word_path = <span class=\"string\">'msyh.ttc'</span></span><br><span class=\"line\">        cloud = wordcloud.WordCloud(</span><br><span class=\"line\">                                    font_path=word_path,</span><br><span class=\"line\">                                    background_color=<span class=\"string\">\"white\"</span>,</span><br><span class=\"line\">                                    scale=<span class=\"number\">15</span>,</span><br><span class=\"line\">                                    stopwords={<span class=\"string\">'的'</span>, <span class=\"string\">'是'</span>, <span class=\"string\">'x20'</span>, <span class=\"string\">'了'</span>, <span class=\"string\">'x0A'</span>, <span class=\"string\">'x2F'</span>, <span class=\"string\">'x0D'</span>, <span class=\"string\">'和'</span>, <span class=\"string\">'去'</span>, <span class=\"string\">'x0Ax0A'</span>, <span class=\"string\">'xOAxOA'</span>,</span><br><span class=\"line\">                                               <span class=\"string\">'xOAxO9xOA'</span>, <span class=\"string\">'x0Ax09x0A'</span>, <span class=\"string\">'x0Ax0A'</span>}</span><br><span class=\"line\">                                    )</span><br><span class=\"line\"></span><br><span class=\"line\">        cloud.generate(texts)</span><br><span class=\"line\">        cloud.to_file(image_save[i])</span><br><span class=\"line\">        f.close()</span><br></pre></td></tr></tbody></table></figure>\n\n<p>当然代码还是不够完美，以后会慢慢改进的</p>\n",
            "tags": [
                "数据分析"
            ]
        }
    ]
}